pub const registers = struct {
<%- for p in device.peripherals -%>
    /// <%= p.desc %>
    pub const <%= p.name.nscase %> = struct {
    pub const base_address = <%= p.base_address.to_hex %>;
    <%- for r in p.registers %>
        /// address: <%= r.address(p.base_address).to_hex %>, path: <%= p.name.nscase %>.<%= r.name.nscase %>
        /// <%= r.desc %>
        <%- case r.type -%>
        <%- when :int -%>
            pub const <%= r.name.nscase %> = @intToPtr(*volatile u<%= r.size %>, base_address + <%= r.address_offset.to_hex %>);
        <%- when :mmio_int -%>
            pub const <%= r.name.nscase %> = mmioInt(base_address + <%= r.address_offset.to_hex %> , <%= r.size %>, u<%= r.bit_width %>);
        <%- else -%>
            pub const <%= r.name.titlecase %> = packed struct {
            <%- for f in r.fields -%>
                <%- if (f.enum and f.enum.values) -%>
                    <%- if f.enum.redirect_to  -%>
                        pub const <%= f.enum.name.titlecase %> = <%= f.enum.redirect_to.path.downcase %>.<%= f.enum.name.titlecase %>;
                    <%- else -%>
                        pub const <%= f.enum.name.titlecase %> = enum(u<%= f.bit_width %>) {
                        <%- for v in f.enum.values -%>
                            <%- next if v.alias -%>
                            <%= v.name.underscore.nscase %> = <%= enum_value(v.value, f.bit_width) %>, // <%= v.desc %>
                        <%- end -%>
                        <%- for v in f.enum.values -%>
                            <%- next unless v.alias -%>
                            pub const <%= v.name.underscore.nscase %> = @intToEnum(<%= f.enum.name.titlecase %>,<%= enum_value(v.value, f.bit_width) %>); // <%= v.desc %>
                        <%- end -%>
                        };
                    <%- end -%>
                <%- end -%>
            <%- end -%>
            <%- for f in r.fields -%>
                <%= "_" if f.is_a?(PaddingField) %><%= f.name.nscase %>: <%- if f.enum -%><%= f.enum.name.titlecase %><%- else -%>u<%= f.bit_width %><%- end -%>,<%- if f.desc or f.enum -%> // <%= f.desc %> <%- if f.enum %> (u<%= f.bit_width %>) <%- end -%> <%- end %>
            <%- end -%>
            };
            pub const <%= r.name.nscase %> = mmio(base_address + <%= r.address_offset.to_hex %>, <%= r.size %>, <%= r.name.titlecase %>);
        <%- end -%>
    <%- end -%>
    };
<%- end -%>
};
